name: deploy

on: [push] # è¡¨ç¤ºä»¥ä¸‹æƒ…å†µå‘ç”Ÿæ—¶è§¦å‘
    # push:
    # workflow_dispatch:
    # schedule:
    #     # Runs everyday at 8:00 AM
    #     - cron: '0 0 * * *'

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."

            - name: Check out repository code
              uses: actions/checkout@v3
              with:
                  # "æœ€è¿‘æ›´æ–°æ—¶é—´"ç­‰ git æ—¥å¿—ç›¸å…³ä¿¡æ¯ï¼Œéœ€è¦æ‹‰å–å…¨éƒ¨æäº¤è®°å½•
                  fetch-depth: 0
                  # å®‰è£… Node ç¯å¢ƒ
            - name: Setup Node.js
              uses: actions/setup-node@v3
              with:
                  # é€‰æ‹©è¦ä½¿ç”¨çš„ node ç‰ˆæœ¬
                  node-version: '18'

                  # ç¼“å­˜ npm node_modules
            - name: Cache dependencies
              uses: actions/cache@v3
              with:
                path: ~/.npm
                key: ${{ runner.os }}-npm-cache-${{ hashFiles('**/package-lock.json') }}
                restore-keys: |
                  ${{ runner.os }}-npm-cache-

            # å®‰è£…ä¾èµ– npm
            - name: Install dependencies
              # å¦‚æœæ²¡æœ‰å‘½ä¸­ç¼“å­˜æ‰æ‰§è¡Œ npm install
              if: steps.cache-deps.outputs.cache-hit != 'true'
              run: npm install

            - name: Build docs
                  run: npm run docs:build

            - name: Deploy to Github Pages
              uses: peaceiris/actions-gh-pages@v3
              with:
                  PERSONAL_TOKEN: ${{ secrets.TOKEN }} # ä¸Šä¸€æ­¥ä¸­ä»“åº“å˜é‡çš„ key
                  EXTERNAL_REPOSITORY: comradewang/comradewang.github.io
                  PUBLISH_BRANCH: master
                  PUBLISH_DIR: src/.vuepress/dist
                  commit_message: ${{ github.event.head_commit.message }}